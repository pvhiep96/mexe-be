<% content_for(:title, "Product Details") %>

<div class="admin-product-show">
  <div class="header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1><%= @product.name %></h1>
    <div>
      <%= link_to "Edit", edit_admin_product_path(@product), class: "btn btn-primary" %>
      <%= link_to "‚Üê Back to Products", admin_products_path, class: "btn btn-secondary" %>
    </div>
  </div>

  <div class="product-details" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">

    <!-- Basic Information -->
    <div class="section" style="margin-bottom: 30px;">
      <h3>Basic Information</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
          <strong>Name:</strong> <%= @product.name %><br>
          <strong>SKU:</strong> <%= @product.sku %><br>
          <strong>Slug:</strong> <%= @product.slug %><br>
          <strong>Brand:</strong> <%= @product.brand&.name || 'N/A' %><br>
          <strong>Category:</strong> <%= @product.category&.name || 'N/A' %>
        </div>
        <div>
          <strong>Price:</strong> <%= number_to_currency(@product.price, unit: "‚Ç´", precision: 0) if @product.price %><br>
          <strong>Original Price:</strong> <%= number_to_currency(@product.original_price, unit: "‚Ç´", precision: 0) if @product.original_price %><br>
          <strong>Stock:</strong> <%= @product.stock_quantity || 0 %><br>
          <strong>Warranty:</strong> <%= @product.warranty_period || 'N/A' %>
        </div>
      </div>
    </div>

    <!-- Status -->
    <div class="section" style="margin-bottom: 30px;">
      <h3>üè∑Ô∏è Product Status & Flags</h3>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
        <span class="badge <%= @product.is_active? ? 'badge-success' : 'badge-danger' %>" style="font-size: 14px; padding: 6px 12px;">
          <%= @product.is_active? ? '‚úÖ Active' : '‚ùå Inactive' %>
        </span>
        <% if @product.is_essential_accessories? %>
          <span class="badge badge-warning">üîß Essential Accessories</span>
        <% end %>
        <% if @product.is_new? %>
          <span class="badge badge-info">üÜï New</span>
        <% end %>
        <% if @product.is_hot? %>
          <span class="badge badge-danger">üî• Hot</span>
        <% end %>
        <% if @product.is_preorder? %>
          <span class="badge badge-secondary">üì¶ Preorder</span>
        <% end %>
        <% if @product.is_trending? %>
          <span class="badge badge-primary">üìà Trending</span>
        <% end %>
        <% if @product.is_ending_soon? %>
          <span class="badge badge-warning-dark">‚è∞ Ending Soon</span>
        <% end %>
        <% if @product.is_arriving_soon? %>
          <span class="badge badge-success-light">üöö Arriving Soon</span>
        <% end %>
      </div>
    </div>

    <!-- Payment Options -->
    <div class="section" style="margin-bottom: 30px;">
      <h3>üí≥ Payment Options</h3>
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
        <% if @product.full_payment_transfer? || @product.partial_advance_payment? %>

          <!-- Full Payment Transfer -->
          <% if @product.full_payment_transfer? %>
            <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #c3e6cb; border-radius: 6px; background: #d4edda;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <span style="font-size: 18px;">üí∞</span>
                <div>
                  <div style="font-weight: 700; color: #155724; font-size: 16px;">
                    Chuy·ªÉn kho·∫£n to√†n b·ªô
                  </div>
                  <div style="font-size: 13px; color: #6c757d;">
                    Kh√°ch h√†ng chuy·ªÉn kho·∫£n 100% s·ªë ti·ªÅn tr∆∞·ªõc khi nh·∫≠n h√†ng
                  </div>
                </div>
              </div>

              <% if @product.full_payment_discount_percentage.present? && @product.full_payment_discount_percentage > 0 %>
                <div style="margin-left: 28px;">
                  <div style="color: #155724; font-weight: 600;">
                    üéâ Gi·∫£m gi√°: <span style="font-size: 18px;"><%= @product.full_payment_discount_percentage %>%</span>
                  </div>
                  <div style="color: #6c757d; font-size: 13px; margin-top: 5px;">
                    <strong>Gi√° g·ªëc:</strong> <%= number_to_currency(@product.price, unit: "‚Ç´", precision: 0) if @product.price %><br>
                    <strong>Gi√° sau gi·∫£m:</strong>
                    <span style="color: #28a745; font-weight: bold;">
                      <%= number_to_currency(@product.full_payment_price, unit: "‚Ç´", precision: 0) if @product.price %>
                    </span><br>
                    <strong>Ti·∫øt ki·ªám:</strong>
                    <span style="color: #dc3545; font-weight: bold;">
                      <%= number_to_currency(@product.price - @product.full_payment_price, unit: "‚Ç´", precision: 0) if @product.price %>
                    </span>
                  </div>
                </div>
              <% else %>
                <div style="margin-left: 28px; color: #6c757d; font-size: 13px;">
                  Kh√¥ng c√≥ gi·∫£m gi√° ƒë·∫∑c bi·ªát
                </div>
              <% end %>
            </div>
          <% end %>

          <!-- Partial Advance Payment -->
          <% if @product.partial_advance_payment? %>
            <div style="margin-bottom: 15px; padding: 15px; border: 1px solid #b6e3ea; border-radius: 6px; background: #d1ecf1;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <span style="font-size: 18px;">üìä</span>
                <div>
                  <div style="font-weight: 700; color: #0c5460; font-size: 16px;">
                    Chuy·ªÉn tr∆∞·ªõc m·ªôt ph·∫ßn
                  </div>
                  <div style="font-size: 13px; color: #6c757d;">
                    Kh√°ch h√†ng tr·∫£ m·ªôt ph·∫ßn tr∆∞·ªõc, ph·∫ßn c√≤n l·∫°i khi nh·∫≠n h√†ng
                  </div>
                </div>
              </div>

              <div style="margin-left: 28px;">
                <% if @product.advance_payment_percentage.present? %>
                  <div style="color: #0c5460; font-weight: 600; margin-bottom: 8px;">
                    üíµ Tr·∫£ tr∆∞·ªõc: <span style="font-size: 18px;"><%= @product.advance_payment_percentage %>%</span>
                  </div>
                  <div style="color: #6c757d; font-size: 13px;">
                    <strong>S·ªë ti·ªÅn tr·∫£ tr∆∞·ªõc:</strong>
                    <span style="color: #0056b3; font-weight: bold;">
                      <%= number_to_currency(@product.advance_payment_amount, unit: "‚Ç´", precision: 0) if @product.price %>
                    </span><br>
                    <strong>C√≤n l·∫°i (COD):</strong>
                    <span style="color: #6c757d; font-weight: bold;">
                      <%= number_to_currency(@product.remaining_payment_amount, unit: "‚Ç´", precision: 0) if @product.price %>
                    </span>

                    <% if @product.advance_payment_discount_percentage.present? && @product.advance_payment_discount_percentage > 0 %>
                      <br><strong>Gi·∫£m gi√° khi tr·∫£ tr∆∞·ªõc:</strong>
                      <span style="color: #28a745; font-weight: bold;"><%= @product.advance_payment_discount_percentage %>%</span>
                      <br><strong>Ti·∫øt ki·ªám:</strong>
                      <span style="color: #dc3545; font-weight: bold;">
                        <%= number_to_currency(@product.advance_payment_amount * @product.advance_payment_discount_percentage / 100, unit: "‚Ç´", precision: 0) if @product.price %>
                      </span>
                    <% end %>
                  </div>
                <% else %>
                  <div style="color: #dc3545; font-size: 13px;">
                    ‚ö†Ô∏è Ch∆∞a c·∫•u h√¨nh % tr·∫£ tr∆∞·ªõc
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

        <% else %>
          <div style="text-align: center; padding: 30px; color: #6c757d;">
            <div style="font-size: 48px; margin-bottom: 10px;">üí≥</div>
            <div style="font-size: 16px; font-weight: 600;">Ch∆∞a c·∫•u h√¨nh payment options</div>
            <div style="font-size: 14px; margin-top: 5px;">
              S·∫£n ph·∫©m n√†y s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c thanh to√°n m·∫∑c ƒë·ªãnh
            </div>
          </div>
        <% end %>
      </div>
    </div>


    <!-- Short Description -->
    <% if @product.short_description.present? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>Short Description</h3>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
          <%= simple_format(@product.short_description) %>
        </div>
      </div>
    <% end %>

    <!-- Product Images -->
    <% if @product.product_images.any? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>Product Images (<%= @product.product_images.count %>)</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
          <% @product.product_images.each do |image| %>
            <div style="border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
              <% if image.image? %>
                <img src="<%= image.image.url rescue '#' %>" alt="<%= image.alt_text %>" style="width: 100%; height: 150px; object-fit: cover;">
              <% else %>
                <div style="width: 100%; height: 150px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                  No Image
                </div>
              <% end %>
              <div style="padding: 10px; font-size: 12px;">
                <div><strong>Alt Text:</strong> <%= image.alt_text || 'N/A' %></div>
                <div><strong>Order:</strong> <%= image.sort_order || 0 %></div>
                <% if image.is_primary? %>
                  <div style="color: #28a745;"><strong>Primary Image</strong></div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Product Descriptions -->
    <% if @product.product_descriptions.any? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>Product Descriptions (<%= @product.product_descriptions.count %>)</h3>
        <% @product.product_descriptions.order(:sort_order).each_with_index do |desc, index| %>
          <div style="border: 1px solid #ddd; border-radius: 4px; padding: 15px; margin-bottom: 15px;">
            <h4><%= desc.title %></h4>
            <div style="margin: 10px 0; color: #666; font-size: 12px;">
              Sort Order: <%= desc.sort_order || 0 %>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
              <%= raw(desc.content) if desc.content.present? %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Product Specifications -->
    <% if @product.product_specifications.any? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>Product Specifications (<%= @product.product_specifications.count %>)</h3>
        <div style="background: white; border-radius: 4px; overflow: hidden; border: 1px solid #ddd;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #f8f9fa;">
              <tr>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Name</th>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Value</th>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Unit</th>
              </tr>
            </thead>
            <tbody>
              <% @product.product_specifications.order(:sort_order).each do |spec| %>
                <tr>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;"><strong><%= spec.spec_name %></strong></td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;"><%= spec.spec_value %></td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;"><%= '-' %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>

    <!-- Product Variants -->
    <% if @product.product_variants.any? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>üé® Product Variants (<%= @product.product_variants.count %>)</h3>
        <div style="background: white; border-radius: 4px; overflow: hidden; border: 1px solid #ddd;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #f8f9fa;">
              <tr>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; width: 10%;">ID</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; width: 20%;">Variant Name</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; width: 20%;">Variant Value</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; width: 15%;">Price Adjustment</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd; width: 15%;">Final Price</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd; width: 10%;">Stock</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; width: 10%;">SKU</th>
              </tr>
            </thead>
            <tbody>
              <% @product.product_variants.each do |variant| %>
                <tr style="<%= 'background: #f8f9fa;' if variant.stock_quantity <= 0 %>">
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;">
                    <code>#<%= variant.id %></code>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;">
                    <strong><%= variant.variant_name %></strong>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;">
                    <span style="display: inline-block; padding: 4px 12px; background: #e3f2fd; color: #1976d2; border-radius: 12px; font-size: 13px; font-weight: 500;">
                      <%= variant.variant_value %>
                    </span>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa; text-align: right;">
                    <% if variant.price_adjustment && variant.price_adjustment != 0 %>
                      <span style="color: <%= variant.price_adjustment > 0 ? '#dc3545' : '#28a745' %>; font-weight: 600;">
                        <%= variant.price_adjustment > 0 ? '+' : '' %><%= number_to_currency(variant.price_adjustment, unit: "‚Ç´", precision: 0) %>
                      </span>
                    <% else %>
                      <span style="color: #6c757d;">‚Äî</span>
                    <% end %>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa; text-align: right;">
                    <strong style="color: #1976d2; font-size: 15px;">
                      <%= number_to_currency((@product.price || 0) + (variant.price_adjustment || 0), unit: "‚Ç´", precision: 0) %>
                    </strong>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa; text-align: center;">
                    <% if variant.stock_quantity && variant.stock_quantity > 0 %>
                      <span style="display: inline-block; padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 13px; font-weight: 600;">
                        <%= variant.stock_quantity %>
                      </span>
                    <% else %>
                      <span style="display: inline-block; padding: 4px 8px; background: #f8d7da; color: #721c24; border-radius: 4px; font-size: 13px; font-weight: 600;">
                        Out of stock
                      </span>
                    <% end %>
                  </td>
                  <td style="padding: 12px; border-bottom: 1px solid #f8f9fa;">
                    <% if variant.sku.present? %>
                      <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">
                        <%= variant.sku %>
                      </code>
                    <% else %>
                      <span style="color: #6c757d; font-style: italic;">N/A</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <!-- Variant Summary -->
        <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 4px; border: 1px solid #dee2e6;">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <div style="color: #6c757d; font-size: 13px; margin-bottom: 5px;">Total Variants</div>
              <div style="font-size: 24px; font-weight: 700; color: #1976d2;">
                <%= @product.product_variants.count %>
              </div>
            </div>
            <div>
              <div style="color: #6c757d; font-size: 13px; margin-bottom: 5px;">Total Stock (All Variants)</div>
              <div style="font-size: 24px; font-weight: 700; color: #28a745;">
                <%= @product.product_variants.sum(:stock_quantity) %>
              </div>
            </div>
            <div>
              <div style="color: #6c757d; font-size: 13px; margin-bottom: 5px;">Price Range</div>
              <div style="font-size: 16px; font-weight: 600; color: #333;">
                <% prices = @product.product_variants.map { |v| (@product.price || 0) + (v.price_adjustment || 0) } %>
                <% if prices.any? %>
                  <%= number_to_currency(prices.min, unit: "‚Ç´", precision: 0) %> - <%= number_to_currency(prices.max, unit: "‚Ç´", precision: 0) %>
                <% else %>
                  N/A
                <% end %>
              </div>
            </div>
            <div>
              <div style="color: #6c757d; font-size: 13px; margin-bottom: 5px;">Available Variants</div>
              <div style="font-size: 24px; font-weight: 700; color: <%= @product.product_variants.where('stock_quantity > 0').count > 0 ? '#28a745' : '#dc3545' %>;">
                <%= @product.product_variants.where('stock_quantity > 0').count %> / <%= @product.product_variants.count %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Product Videos -->
    <% if @product.product_videos.any? %>
      <div class="section" style="margin-bottom: 30px;">
        <h3>Product Videos (<%= @product.product_videos.count %>)</h3>
        <% @product.product_videos.ordered.each_with_index do |video, index| %>
          <div style="border: 1px solid #ddd; border-radius: 4px; padding: 15px; margin-bottom: 15px;">
            <div style="display: grid; grid-template-columns: 200px 1fr; gap: 15px;">
              <!-- Video Thumbnail/Embed -->
              <div>
                <% if video.youtube? && video.thumbnail_url %>
                  <div style="position: relative;">
                    <img src="<%= video.thumbnail_url %>" alt="<%= video.title %>" style="width: 100%; height: 112px; object-fit: cover; border-radius: 4px;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                      ‚ñ∂
                    </div>
                  </div>
                <% else %>
                  <div style="width: 100%; height: 112px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #666;">
                    üìπ Video
                  </div>
                <% end %>
              </div>

              <!-- Video Info -->
              <div>
                <h4 style="margin: 0 0 8px 0;"><%= video.title %></h4>
                <div style="color: #666; font-size: 14px; margin-bottom: 8px;">
                  <strong>URL:</strong>
                  <a href="<%= video.url %>" target="_blank" style="color: #007bff;"><%= video.url %></a>
                </div>
                <% if video.description.present? %>
                  <div style="color: #333; font-size: 14px; margin-bottom: 8px;">
                    <%= simple_format(video.description) %>
                  </div>
                <% end %>
                <div style="font-size: 12px; color: #666;">
                  <span><strong>Sort Order:</strong> <%= video.sort_order || 0 %></span>
                  <span style="margin-left: 15px;">
                    <span class="badge <%= video.is_active? ? 'badge-success' : 'badge-danger' %>">
                      <%= video.is_active? ? 'Active' : 'Inactive' %>
                    </span>
                  </span>
                  <span style="margin-left: 15px; color: #999;">
                    <% if video.youtube? %>
                      üì∫ YouTube
                    <% elsif video.vimeo? %>
                      üé• Vimeo
                    <% else %>
                      üåê Video
                    <% end %>
                  </span>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Metadata -->
    <div class="section" style="margin-bottom: 30px;">
      <h3>Metadata</h3>
      <div>
        <strong>Created:</strong> <%= @product.created_at.strftime("%Y-%m-%d %H:%M") %><br>
        <strong>Updated:</strong> <%= @product.updated_at.strftime("%Y-%m-%d %H:%M") %><br>
        <strong>View Count:</strong> <%= @product.view_count || 0 %><br>
        <strong>Meta Title:</strong> <%= @product.meta_title || 'N/A' %><br>
        <strong>Meta Description:</strong> <%= @product.meta_description || 'N/A' %>
      </div>
    </div>
  </div>
</div>

<style>
  .badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
  }

  .badge-success { background: #28a745; color: white; }
  .badge-danger { background: #dc3545; color: white; }
  .badge-primary { background: #007bff; color: white; }
  .badge-info { background: #17a2b8; color: white; }
  .badge-warning { background: #ffc107; color: black; }
  .badge-secondary { background: #6c757d; color: white; }
  .badge-warning-dark { background: #e65100; color: white; }
  .badge-success-light { background: #66bb6a; color: white; }

  .btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 2px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    border: 1px solid #007bff;
  }

  .btn:hover {
    background: #0056b3;
    border-color: #0056b3;
    color: white !important;
  }

  .btn-primary {
    background: #007bff;
    border-color: #007bff;
  }

  .btn-secondary {
    background: #6c757d;
    border-color: #6c757d;
  }

  .btn-primary:hover {
    background: #0056b3;
    border-color: #0056b3;
    color: white !important;
  }

  .btn-secondary:hover {
    background: #545b62;
    border-color: #545b62;
    color: white !important;
  }

  .btn-success:hover {
    background: #1e7e34;
    border-color: #1e7e34;
    color: white !important;
  }

  .btn-danger:hover {
    background: #bd2130;
    border-color: #bd2130;
    color: white !important;
  }

  .btn-warning:hover {
    background: #e0a800;
    border-color: #e0a800;
    color: #212529 !important;
  }

  .btn-info:hover {
    background: #117a8b;
    border-color: #117a8b;
    color: white !important;
  }

  .btn-outline-primary:hover {
    background: #007bff;
    border-color: #007bff;
    color: white !important;
  }

  .btn-outline-secondary:hover {
    background: #6c757d;
    border-color: #6c757d;
    color: white !important;
  }

  .btn-outline-success:hover {
    background: #28a745;
    border-color: #28a745;
    color: white !important;
  }

  .btn-outline-danger:hover {
    background: #dc3545;
    border-color: #dc3545;
    color: white !important;
  }
</style>
