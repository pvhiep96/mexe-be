<div class="container mx-auto px-4 py-8">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Product Images -->
    <div>
      <!-- Main Image Display -->
      <div class="main-image-container mb-4">
        <% if @product.main_image.present? %>
          <%= image_tag @product.main_image.url(:large), 
                        id: "main-product-image",
                        class: "w-full h-96 object-cover rounded-lg shadow-lg cursor-zoom-in",
                        alt: @product.name %>
        <% else %>
          <div class="w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center">
            <span class="text-gray-500 text-xl">Không có ảnh</span>
          </div>
        <% end %>
      </div>
      


      <!-- Additional Images Display (giống như ảnh chính) -->
      <% if @product.safe_images.any? %>
        <div class="additional-images-section mt-8">
          <h4 class="text-lg font-semibold mb-4 text-gray-800">Ảnh bổ sung</h4>
          
          <div class="space-y-6">
            <% @product.safe_images.each_with_index do |image, index| %>
              <% if image.present? %>
                <div class="additional-image-item bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                  <div class="flex flex-col lg:flex-row gap-4">
                    <!-- Image Display -->
                    <div class="lg:w-1/2">
                      <div class="bg-gray-100 rounded-lg overflow-hidden">
                        <%= image_tag image.url(:large), 
                                      class: "w-full h-64 lg:h-80 object-cover",
                                      alt: "#{@product.name} - Ảnh bổ sung #{index + 1}",
                                      loading: "lazy" %>
                      </div>
                      
                      <!-- Image Info -->
                      <div class="mt-3 text-center">
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                          Ảnh bổ sung #<%= index + 1 %>
                        </span>
                      </div>
                    </div>
                    
                    <!-- Thumbnails và Actions -->
                    <div class="lg:w-1/2 flex flex-col justify-center">
                      <div class="text-center lg:text-left mb-4">
                        <h5 class="text-lg font-medium text-gray-900 mb-2">
                          <%= @product.name %> - Góc nhìn <%= index + 1 %>
                        </h5>
                        <p class="text-gray-600 text-sm">
                          Xem chi tiết sản phẩm từ góc độ khác nhau để có cái nhìn tổng quan nhất.
                        </p>
                      </div>
                      
                      <!-- Thumbnail versions -->
                      <div class="flex justify-center lg:justify-start gap-2 mb-4">
                        <div class="text-xs text-gray-500 mb-2 w-full">Kích thước có sẵn:</div>
                      </div>
                      <div class="flex justify-center lg:justify-start gap-2">
                        <%= link_to image.url(:thumb), target: "_blank", 
                                    class: "inline-block border border-gray-300 rounded overflow-hidden hover:border-blue-400 transition-colors" do %>
                          <%= image_tag image.url(:thumb), 
                                        class: "w-12 h-12 object-cover",
                                        title: "Xem kích thước nhỏ" %>
                        <% end %>
                        
                        <%= link_to image.url(:small), target: "_blank", 
                                    class: "inline-block border border-gray-300 rounded overflow-hidden hover:border-blue-400 transition-colors" do %>
                          <%= image_tag image.url(:thumb), 
                                        class: "w-12 h-12 object-cover",
                                        title: "Xem kích thước trung bình nhỏ" %>
                        <% end %>
                        
                        <%= link_to image.url(:medium), target: "_blank", 
                                    class: "inline-block border border-gray-300 rounded overflow-hidden hover:border-blue-400 transition-colors" do %>
                          <%= image_tag image.url(:thumb), 
                                        class: "w-12 h-12 object-cover",
                                        title: "Xem kích thước trung bình" %>
                        <% end %>
                        
                        <%= link_to image.url(:large), target: "_blank", 
                                    class: "inline-block border border-gray-300 rounded overflow-hidden hover:border-blue-400 transition-colors" do %>
                          <%= image_tag image.url(:thumb), 
                                        class: "w-12 h-12 object-cover",
                                        title: "Xem kích thước lớn" %>
                        <% end %>
                      </div>
                      
                      <!-- Action Button -->
                      <div class="mt-4 text-center lg:text-left">
                        <%= link_to image.url(:large), target: "_blank", 
                                    class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors" do %>
                          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                          </svg>
                          Xem ảnh full size
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Thumbnail Gallery (giữ lại cho navigation nhanh) -->
      <% if @product.has_images? %>
        <div class="thumbnail-gallery mt-8">
          <h4 class="text-lg font-semibold mb-3 text-gray-800">Điều hướng nhanh</h4>
          <div class="grid grid-cols-4 md:grid-cols-6 gap-3">
            <!-- Main Image Thumbnail -->
            <% if @product.main_image.present? %>
              <div class="thumbnail-item border-2 border-blue-500">
                <%= image_tag @product.main_image.url(:thumb), 
                              class: "w-full h-16 object-cover rounded cursor-pointer thumbnail-img",
                              data: { large: @product.main_image.url(:large) },
                              alt: "#{@product.name} - Ảnh chính" %>
                <div class="text-xs text-center mt-1 text-blue-600 font-medium">Chính</div>
              </div>
            <% end %>
            
            <!-- Additional Images Thumbnails -->
            <% @product.safe_images.each_with_index do |image, index| %>
              <% if image.present? %>
                <div class="thumbnail-item border-2 border-gray-200 hover:border-blue-400 transition-colors duration-200">
                  <%= image_tag image.url(:thumb), 
                                class: "w-full h-16 object-cover rounded cursor-pointer thumbnail-img",
                                data: { large: image.url(:large) },
                                alt: "#{@product.name} - Ảnh #{index + 1}" %>
                  <div class="text-xs text-center mt-1 text-gray-600">Ảnh <%= index + 1 %></div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <!-- Product Info -->
    <div>
      <h1 class="text-3xl font-bold mb-4"><%= @product.name %></h1>
      
      <div class="mb-4">
        <span class="text-2xl font-bold text-blue-600">
          <%= number_to_currency(@product.price, unit: "₫", precision: 0) %>
        </span>
        <% if @product.original_price && @product.original_price > @product.price %>
          <span class="text-lg text-gray-500 line-through ml-2">
            <%= number_to_currency(@product.original_price, unit: "₫", precision: 0) %>
          </span>
        <% end %>
      </div>
      
      <div class="mb-6">
        <p class="text-gray-700"><%= @product.short_description %></p>
      </div>
      
      <div class="mb-6">
        <h3 class="font-semibold mb-2">Thông tin sản phẩm:</h3>
        <ul class="space-y-2 text-sm text-gray-600">
          <li><strong>SKU:</strong> <%= @product.sku %></li>
          <li><strong>Thương hiệu:</strong> <%= @product.brand&.name %></li>
          <li><strong>Danh mục:</strong> <%= @product.category&.name %></li>
          <li><strong>Tình trạng:</strong> 
            <% if @product.stock_quantity > 0 %>
              <span class="text-green-600">Còn hàng</span>
            <% else %>
              <span class="text-red-600">Hết hàng</span>
            <% end %>
          </li>
        </ul>
      </div>
      
      <div class="mb-6">
        <h3 class="font-semibold mb-2">Mô tả chi tiết:</h3>
        <% @product.product_descriptions.active.ordered.each do |desc| %>
          <div class="mb-4">
            <h4 class="font-medium text-lg mb-2"><%= desc.title %></h4>
            <div class="prose max-w-none"><%= desc.content.html_safe %></div>
          </div>
        <% end %>
      </div>
      
      <% if @product.product_specifications.any? %>
        <div class="mb-6">
          <h3 class="font-semibold mb-2">Thông số kỹ thuật:</h3>
          <div class="bg-gray-50 p-4 rounded-lg">
            <% @product.product_specifications.active.ordered.each do |spec| %>
              <div class="flex justify-between py-2 border-b border-gray-200 last:border-b-0">
                <span class="font-medium"><%= spec.spec_name %></span>
                <span class="text-gray-600">
                  <%= spec.spec_value %>
                  <% if spec.unit.present? %>
                    <span class="text-sm text-gray-500"><%= spec.unit %></span>
                  <% end %>
                </span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Related Products -->
  <% if @related_products.any? %>
    <div class="mt-16">
      <h2 class="text-2xl font-bold mb-6">Sản phẩm liên quan</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <% @related_products.each do |product| %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <% if product.main_image.present? %>
              <%= image_tag product.main_image.url(:medium), class: "w-full h-48 object-cover" %>
            <% else %>
              <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                <span class="text-gray-500">Không có ảnh</span>
              </div>
            <% end %>
            
            <div class="p-4">
              <h3 class="font-semibold text-lg mb-2"><%= product.name %></h3>
              <p class="text-xl font-bold text-blue-600"><%= number_to_currency(product.price, unit: "₫", precision: 0) %></p>
              
              <%= link_to "Xem chi tiết", product_path(product.slug), class: "mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<!-- JavaScript for Image Gallery -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const mainImage = document.getElementById('main-product-image');
  const thumbnails = document.querySelectorAll('.thumbnail-img');
  const thumbnailItems = document.querySelectorAll('.thumbnail-item');
  
  if (mainImage && thumbnails.length > 0) {
    thumbnails.forEach((thumbnail, index) => {
      thumbnail.addEventListener('click', function() {
        // Get the large image URL from data attribute
        const largeImageUrl = thumbnail.getAttribute('data-large');
        
        if (largeImageUrl) {
          // Update main image src
          mainImage.src = largeImageUrl;
          
          // Update active thumbnail styling
          thumbnailItems.forEach(item => {
            item.classList.remove('border-blue-500');
            item.classList.add('border-gray-200');
          });
          
          // Add active styling to clicked thumbnail
          const clickedItem = thumbnail.closest('.thumbnail-item');
          clickedItem.classList.remove('border-gray-200');
          clickedItem.classList.add('border-blue-500');
        }
      });
    });
    
    // Add zoom effect on main image hover
    mainImage.addEventListener('mouseenter', function() {
      this.style.transform = 'scale(1.05)';
      this.style.transition = 'transform 0.3s ease';
    });
    
    mainImage.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1)';
    });
  }
});
</script>

<!-- Custom CSS for Image Gallery -->
<style>
.thumbnail-item {
  transition: all 0.2s ease;
}

.thumbnail-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.thumbnail-img {
  transition: opacity 0.2s ease;
}

.thumbnail-img:hover {
  opacity: 0.8;
}

#main-product-image {
  transition: transform 0.3s ease;
}

.image-gallery {
  background: linear-gradient(to bottom, #f8fafc, #f1f5f9);
  padding: 1rem;
  border-radius: 0.5rem;
  border: 1px solid #e2e8f0;
}

.main-image-container {
  position: relative;
  overflow: hidden;
  border-radius: 0.5rem;
}

.main-image-container::after {
  content: "🔍 Click để phóng to";
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.main-image-container:hover::after {
  opacity: 1;
}
</style>
